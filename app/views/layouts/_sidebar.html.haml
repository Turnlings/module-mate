.top  
  .side-heading
    .d-flex.flex-row.align-items-center
      %button.btn.btn-link.icon-button.hide-lg{ type: "button", aria: { label: "Open menu" }, data: { bs_toggle: "offcanvas", bs_target: "#sidebarOffcanvas" } }
        %i.fa-solid.fa-bars.fs-2
      .title= link_to "ModuleMate", root_path

    .account.hide-lg
      - if user_signed_in?
        = link_to user_path(current_user), class: 'unstyle-link profile' do
          %i.fa-solid.fa-circle-user
          %span= current_user.email
      - else
        = link_to "Sign In", new_user_session_path, style: "font-size: 20px;"

      %button.theme-toggle.icon-button.float-end.moon
        %i.fa-solid.fa-moon

  -# Desktop sidebar content
  .side-content
    -# Modules
    .module-list
      %hr
      = link_to root_path do
        Dashboard
      = link_to "Quicklog",
        quick_log_form_path,
        data: { turbo_frame: "modal"}
      = link_to all_upcoming_assessments_path do
        Assessments
      = link_to uni_modules_path do
        All Modules
      - if @pinned_modules.present?
        %hr 
        .font-secondary.px-3 Pinned Modules
        - @pinned_modules.each do |m|
          = link_to m, class: "#{'module-selected' if m == @uni_module}" do
            .name-row
              .mod-name= m.name
              .mod-code= m.code

      %hr

      -# TODO: Do I want a link to all upcoming exams 
      .font-secondary.px-3 Next Assessment
      - if @next_exams
        - @next_exams.each do |exam|
          = render partial: 'shared/exam_card', locals: { exam: exam }
      - else
        %span No upcoming assessments.

-# Mobile offcanvas menu
.offcanvas.offcanvas-start.hide-lg#sidebarOffcanvas{ tabindex: "-1", aria: { labelledby: "sidebarOffcanvasLabel" } }
  .offcanvas-header
    %h5.offcanvas-title#sidebarOffcanvasLabel Menu
    %button.btn-close{ type: "button", aria: { label: "Close" }, data: { bs_dismiss: "offcanvas" } }
  .offcanvas-body
    -# Reuse the same navigation content as desktop
    .side-content.mt-0{ style: "display: flex;" }
      -# Modules
      .module-list
        = link_to root_path do
          Dashboard
        = link_to "Quicklog",
          quick_log_form_path,
          data: { turbo_frame: "modal" }
        = link_to all_upcoming_assessments_path do
          Assessments
        = link_to uni_modules_path do
          All Modules
        - if @pinned_modules.present?
          %hr
          .font-secondary.px-3 Pinned Modules
          - @pinned_modules.each do |m|
            = link_to m, class: "#{'module-selected' if m == @uni_module}" do
              .name-row
                .mod-name= m.name
                .mod-code= m.code

        %hr

        .font-secondary.px-3 Upcoming Assessments
        - if @next_exams
          - @next_exams.each do |exam|
            = link_to uni_module_exam_path(exam.uni_module, exam) do
              .name-row
                .text-truncate= exam.name
                .mod-code= exam.uni_module.code
              .date-row
                .due-date.font-secondary
                  Due:
                  = exam.due.strftime("%d %b %Y, %H:%M")
                - if exam.due < 1.day.from_now
                  .chip-danger= "#{((exam.due - Time.current)/1.hour).floor} Hours"
                - elsif exam.due < 1.week.from_now
                  .chip-warning= "#{(exam.due.to_date - Date.today).to_i} Days"
        - else
          %span No upcoming assessments.

.bottom.show-lg
  .account-bottom
    - if user_signed_in?
      = link_to user_path(current_user), class: 'unstyle-link profile' do
        %i.fa-solid.fa-circle-user
        %span= current_user.email
    - else
      = link_to "Sign In", new_user_session_path, style: "font-size: 20px;"

    %button.theme-toggle.icon-button.float-end.moon
      %i.fa-solid.fa-moon